<div class="container">
  <form class="grid-container" [formGroup]="control">
    <label tuiLabel class="label">Ключ:</label>
    <tui-textfield class="value">
      <input tuiTextfield [readOnly]="true" formControlName="key"/>
    </tui-textfield>
    <label tuiLabel class="label">Название:</label>
    <tui-textfield class="value">
      <input tuiTextfield formControlName="name"/>
    </tui-textfield>
    <label tuiLabel class="label">Описание:</label>
    <tui-textfield>
      <textarea tuiTextarea formControlName="description"></textarea>
    </tui-textfield>
    <label tuiLabel class="label">Основная ветка:</label>
    <tui-textfield class="value">
      <input tuiTextfield formControlName="mainBranch"/>
    </tui-textfield>
    <label tuiLabel class="label">Время жизни релиза по умолчанию:</label>
    <div class="release-lifetime-container">
      <app-input-lifetime formControlName="latestReleaseLifetime">
        <label tuiLabel>Удалять последний релиз</label>
      </app-input-lifetime>
      <app-input-lifetime formControlName="releaseLifetime">
        <label tuiLabel>Удалять остальные релизы</label>
      </app-input-lifetime>
    </div>
  </form>
  <div class="buttons-container">
    @if (!isEditing) {
      <button tuiButton size="m" iconStart="@tui.pencil" (click)="startEditing()">Редактировать</button>
      <button tuiButton size="m" iconStart="@tui.trash" appearance="primary-destructive" (click)="deleteApplication()">
        Удалить приложение
      </button>
    } @else {
      <button tuiButton size="m" iconStart="@tui.save" appearance="primary-destructive" (click)="cancelChanges()">
        Отменить
      </button>
      <button tuiButton size="m" iconStart="@tui.save" (click)="saveChanges()">Сохранить</button>
    }
  </div>
  <div class="installers-container">
    <div class="installers-header-container">
      <h2>Используемые установщики:</h2>
      <button tuiButton size="m" iconStart="@tui.plus" (click)="newInstaller()">Добавить</button>
    </div>
    <div class="using-installers-container">
      @for (usingInstaller of usingInstallers$ | async; track usingInstaller.id) {
        <div tuiAppearance="floating" tuiCardLarge *tuiLet="getBuilder(usingInstaller) | async as installerBuilder">
          <div class="card-container">
            <h3 class="card-header">{{ usingInstaller.name || installerBuilder?.displayName }}</h3>
            <button
              size="s"
              tuiIconButton
              type="button"
              iconStart="@tui.pencil"
              appearance="flat"
              (click)="updateInstaller(usingInstaller)"
            ></button>
            <button
              size="s"
              tuiIconButton
              type="button"
              iconStart="@tui.trash"
              appearance="flat-destructive"
              (click)="removeInstaller(usingInstaller)"
            ></button>
          </div>
        </div>
      }
    </div>
  </div>
</div>
